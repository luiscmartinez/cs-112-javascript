<!DOCTYPE html>
<html lang="en">

<head>
	<title>Huskies Computer Club Fundraising Shop</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="../css/index.css">
	<script type="text/javascript" src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body>
	<div id="overlay"></div>
	<header>
		<a href="index.html" class="nav-left"> <img src="../images/computer-club-logo.png"
				alt="webstie logo - image of a dog" /> </a>
		<h1>The Huskies Fundraising Shop</h1>
		<a href="cart.html" class="nav-right">
			<div class="bubble-container">
				<img src="../images/shopping-cart-logo.png" alt="shopping cart symbol" />
				<div id="cart_count">0</div>
			</div>
		</a>
	</header>
	<div id="toast" class="toast">
		<div id="toast-header" class="toast-header">
			Success!
		</div>
		<div id="toast-body" class="toast-body"></div>
	</div>
	<main>
		<div id="items">
		</div>
	</main>
	<div id="rightPanel" class="hidden">This is a hidden panel!</div>
	<footer>
		<a href="https://www.instagram.com/huskiescomputerclub" target="_blank">Instagram</a>
		<a href="/">Huskies Computer Club</a>
	</footer>
	<script>
		// Example JSON Data
		const jsonData = {
			"items": [
				{
					"id": 1,
					"name": "Item 1",
					"description": "Description of Item 1",
					"price": 9.99,
					"image": "beef.jpg",
				},
				{
					"id": 2,
					"name": "Item 2",
					"description": "Description of Item 2",
					"price": 19.99,
					"image": "cake.jpg"
				},
				{
					"id": 3,
					"name": "Item 3",
					"description": "Description of Item 3",
					"price": 2.99,
					"image": "jello.png",
					"options": {
						"flavor": ["Lemon", "Grape", "Cherry"],
						"size": ["small", "med", "large"]
					}
				}
				, {
					"id": 4,
					"name": "Item 4",
					"description": "Description of Item 4",
					"price": 29.99,
					"image": "meat-dish.png"
				},
				{
					"id": 5,
					"name": "Item 5",
					"description": "Description of Item 5",
					"price": 5.99,
					"image": "pizza.jpg"
				}
			]
		};
		// Add to Cart
		function addToCart(addItem) {
			console.log('adding to cart', addItem)
			const { id, name, price } = addItem
			let cart = JSON.parse(localStorage.getItem('cart')) || [];
			let found = cart.find(item => item.id === id);

			if (found) {
				found.quantity += 1;
			} else {
				cart.push({ id, name, quantity: 1, price });
			}

			localStorage.setItem('cart', JSON.stringify(cart));
			updateCartUI();
		}

		// Update Cart UI
		function updateCartUI() {
			let cart = JSON.parse(localStorage.getItem('cart')) || [];
			$('#cart_count').empty();
			$('#cart_count').text(cart.reduce((accumulator, item) => {
				return accumulator + item.quantity;
			}, 0));
		}

		function showToast(message) {
			$('#toast-body').html(message);
			$('#toast').addClass('show');
			setTimeout(function () {
				$('#toast').removeClass('show');
			}, 3000);

		}
		$(document).ready(function () {
			updateCartUI();
			const $container = $("#items")
			$container.empty()
			const $rightPanel = $('#rightPanel')
			const $overlay = $('#overlay');

			// Function to render items
			jsonData.items.forEach((item, i) => {
				const itemContent = `
            <img id=${item.id} src="../images/${item.image}" alt="${item.name}" style="max-width: 300px; height: 200px;">
            <h2>${item.name}</h2>
            <p>${item.description}</p>
            <p>Price: $${item.price}</p>
        `;
				let btn = `<button class="add-to-cart" data-id="${item.id}">Add To Cart</button>`
				if (item?.options) {
					btn = `<button class="toggleButton" data-id="${item.id}">Add To Cart</button>`
				}
				$('<div/>', {
					'class': 'item',
					html: itemContent + btn
				}).appendTo($container);

				$(document).on('click', `.add-to-cart[data-id='${item.id}']`, function () {
					const itemId = $(this).data('id');
					console.log('Item clicked:', itemId);
					//! You can add more logic here to handle the click event
					addToCart(item)
					showToast('<div>Item added to your cart! <a href="cart.html">view cart</a></div>');
				});
				$(document).on('click', `.toggleButton[data-id='${item.id}']`, function () {
					const itemId = $(this).data('id');
					console.log('Item wid options got clicked:', itemId, item);
					//! You can add more logic here to handle the click event
					$rightPanel.slideToggle();
					$overlay.fadeIn();
					let $optionsForm = $('<form id="optionsForm"></form>')
					let formContent = ""
					const itemOptions = item.options
					for (let key in itemOptions) {
						if (itemOptions.hasOwnProperty(key)) {
							const optionName = key
							const optionValues = itemOptions[key]
							const optionContent = `
								<div> 
									<h3>${key}</h3>
									${optionValues.map((optionValue) => {
								return (
									`
											<input type="radio" id="${key + optionValue}" name="${key}" value="${optionValue}">
											<label for="${key + optionValue}">${optionValue}</label><br>
											`
								)
							}).join("")}
								</div>
							`
							formContent += optionContent
						}
					}
					formContent += `<div><button type="submit">Add To Cart</button></div>`
					$optionsForm.append(formContent)
					$rightPanel.html($optionsForm);
					$("#optionsForm").on("submit", function (e) {
						e.preventDefault();
						console.log("event", e)
						console.log("this", this)
						// serialize gets the data ready to be send over network
						let formData = $(this).serialize();
						console.log(formData, item);
						// taking the serialize form data without sending over network might eventually break;
						const params = new URLSearchParams(formData)
						const options = Object.fromEntries(params)

						addToCart({ ...item, options })
						showToast('<div>Item added to your cart! <a href="cart.html">view cart</a></div>');
						$rightPanel.slideUp();
						$overlay.fadeOut();
					})
				});
			})

			// on hover change pizza img
			$(function () {
				$('#5').hover(function () {
					$('#5').attr('src', '../images/pizza-2.jpg')
				},
					function () {
						$('#5').attr('src', "../images/pizza.jpg")
					}
				)
			})

			// show panel
			$overlay.click(function () {
				// $rightPanel.animate({ right: '-200px' }, 500);
				$overlay.fadeOut();
			});

			$(document).click(function (event) {
				// Check if the click is outside the panel and if the panel is visible
				if (!$(event.target).closest('#rightPanel, .toggleButton').length && $rightPanel.is(':visible')) {
					$rightPanel.slideUp();
					// $rightPanel.animate({ right: '-200px' }, 500);
					$overlay.fadeOut();
				}
			});
		})

	</script>
</body>

</html>